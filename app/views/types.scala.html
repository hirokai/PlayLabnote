@import play.api.libs.json.{JsValue,Json}
@import models.Database.Id

@(oid: Option[Id], dat: JsValue)


<!DOCTYPE HTML>
<html lang="en" ng-app="typesApp">
    <head>
        <link rel="stylesheet" media="screen" href="@routes.Assets.at("stylesheets/bootstrap.min.css")">
        <link rel="stylesheet" media="screen" href="@routes.Assets.at("stylesheets/angular-ui-tree.min.css")">
        <link rel="stylesheet" media="screen" href="@routes.Assets.at("stylesheets/main.css")">
        <link rel="stylesheet" media="screen" href="@routes.Assets.at("stylesheets/types.css")">
        <link rel="shortcut icon" type="image/png" href="@routes.Assets.at("images/favicon.png")">
        <meta charset="UTF-8">
        <title></title>
    </head>
    <body ng-cloak ng-controller='typesAppCtrl' class='container'>


        <div class='row'>
            <ul>
                <li><a href="/exps">Exps</a></li>
                <li><a href="/samples">Samples</a></li>
                <li><a href="/types">Types</a></li>
                <li><a href=""></a></li>
                <li><a href=""></a></li>
            </ul>
            <script type="text/ng-template" id="nodes_renderer.html">
                <div ui-tree-handle class="tree-node tree-node-content" ng-click='clickTree(this)' ng-dblclick='dblClickTree(this)' >
                    <a class="btn btn-success btn-xs" ng-if="node.nodes && node.nodes.length > 0" data-nodrag ng-click="toggle(this)"><span class="glyphicon" ng-class="{'glyphicon-chevron-right': collapsed, 'glyphicon-chevron-down': !collapsed}"></span></a>
                    {{node.title}}
                    <a class="pull-right btn btn-danger btn-xs" data-nodrag ng-click="removeItem(this)"><span class="glyphicon glyphicon-remove"></span></a>
                    <a class="pull-right btn btn-primary btn-xs" data-nodrag ng-click="newSubItem(this)" style="margin-right: 8px;"><span class="glyphicon glyphicon-plus"></span></a>
                </div>
                <ol ui-tree-nodes="" ng-model="node.nodes" ng-class="{hidden: collapsed}">
                    <li ng-repeat="node in node.nodes" ui-tree-node ng-include="'nodes_renderer.html'">
            </li>
                </ol>
            </script>
            <div class='col-md-4' ui-tree data-drag-enabled=false id="tree-root">
                <ol ui-tree-nodes="" ng-model="treedata">
                    <li ng-repeat="node in treedata" ui-tree-node ng-include="'nodes_renderer.html'"></li>
                </ol>
            </div>
            <div class='row' class='col-md-6'>
                @*<pre>{{treedata|json}}</pre>*@
            <div  ng-controller='titleController'>
                <div editable-title ></div>
            </div>

                <section class='col-md-5'>
                        <h3>Samples of this type</h3>
                        <button class='btn btn-sm' ng-click='addSample()'>Add</button>
                        <input id='show_subtypes' type="checkbox" ng-model='showSubtypes'/>
                        <label for="show_subtypes">Show subtypes</label>
                    {{showSubtypes}}
                        <table class='table col-md-3'>
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Type</th>
                                    <th>Date made</th>
                                    <th>Exp used</th>
                                    <th>Note</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat='sample in detail.samples'>
                                    <td><a href="/samples/{{sample.id}}">{{sample.name}}</a></td>
                                    <td>{{sample.typ.name}}</td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                </tr>
                            </tbody>
                        </table>


                </section>

            </div>

        </div>

        <script type="text/javascript">
        data = {id: @(oid.map(_.toString).getOrElse("null")), tree: @Html(dat.toString)}; // FIXME: Quotes should be added when using string ID.
        </script>

        <script src="@routes.Assets.at("javascripts/underscore-min.js")" type="text/javascript"></script>
        <script src="@routes.Assets.at("javascripts/jquery-1.11.1.min.js")" type="text/javascript"></script>
        <script src="@routes.Assets.at("javascripts/bootstrap.min.js")" type="text/javascript"></script>
        <script type="text/javascript" src='/assets/javascripts/angular.min.js'></script>
        <script type="text/javascript" src='/assets/javascripts/angular-route.js'></script>
        <script type="text/javascript" src='/assets/javascripts/angular-ui-tree.js'></script>
        <script src="@routes.Assets.at("javascripts/my_directives.js")" type="text/javascript"></script>

        <script type="text/javascript" src='/assets/javascripts/types.js'></script>
    </body>

</html>
