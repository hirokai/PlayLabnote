@import play.api.libs.json.{JsValue,Json}


<!DOCTYPE html>
<html lang="en-US" ng-app='expsApp'>
    <head>
        <link rel="stylesheet" media="screen" href="@routes.Assets.at("stylesheets/bootstrap.min.css")">
        <link rel="stylesheet" media="screen" href="@routes.Assets.at("stylesheets/main.css")">
        <link rel="stylesheet" media="screen" href="@routes.Assets.at("stylesheets/angular-ui-tree.min.css")">
        <link rel="stylesheet" media="screen" href="@routes.Assets.at("stylesheets/experiment_list.css")">
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>List of experiments</title>
    </head>
    <body ng-cloak ng-controller='itemListAndDetailCtrl' class='container'>
        <div class='row'>
            <div class='col-md-3' ng-controller='itemListCtrl'>
                <tabset type="tabs">
                    <tab ng-repeat="tab in tabs" heading="{{tab.title}}" active="tab.active" disabled="tab.disabled">
                        {{tab.content}}
                    </tab>
                </tabset>

                <div ng-if='isExpTab()'>
                    <button class='btn btn-default' ng-click='addExp()'>Add exp</button>
                    <ul>
                        <li ng-repeat='exp in exps' class='exp_list_item' ng-class='{selected: exp.id==selectedItem.exp.id}' ng-click='clickList(exp,$event)'>
                            <div ng-click='clickList(exp,$event)'>{{exp.title}}</div>
                        </li>
                    </ul>

                </div>
                <div ng-if='isSampleTab()'>
                    <button class='btn btn-default' ng-click='addSample()'>Add sample</button>
                    <input type="text" ng-model='freeword.title'/>
                    <span>{{(samples| filter:freeword).length}}/{{samples.length}} samples shown.</span>
                    <ul>
                        <li ng-repeat='sample in samples| filter:freeword' class='sample_list_item' ng-class='{selected: sample.id==selectedItem.sample.id}' ng-click='clickList(sample,$event)'>
                            <div ng-click='clickList(sample,$event)'>{{sample.title}}</div>
                        </li>
                    </ul>

                </div>
                <div ng-if='isTypeTab()'>
                    <script type="text/ng-template" id="nodes_renderer.html">
                        <div ui-tree-handle class="tree-node tree-node-content" ng-click='clickTree(this)' ng-dblclick='dblClickTree(this)' ng-class='{selected: node.id==selectedItem.type.id}' >
                            <a class="btn btn-success btn-xs" ng-if="node.nodes && node.nodes.length > 0" data-nodrag ng-click="toggle(this)"><span class="glyphicon" ng-class="{'glyphicon-chevron-right': collapsed, 'glyphicon-chevron-down': !collapsed}"></span></a>
                            {{node.title}}
                            <a class="pull-right btn btn-danger btn-xs" data-nodrag ng-click="deleteTypeItem(this)"><span class="glyphicon glyphicon-remove"></span></a>
                            <a class="pull-right btn btn-primary btn-xs" data-nodrag ng-click="newSubItem(this)" style="margin-right: 8px;"><span class="glyphicon glyphicon-plus"></span></a>
                        </div>
                        <ol ui-tree-nodes="" ng-model="node.nodes" ng-class="{hidden: collapsed}">
                            <li ng-repeat="node in node.nodes" ui-tree-node ng-include="'nodes_renderer.html'">
            </li>
                        </ol>
                    </script>
                    <div ui-tree data-drag-enabled=false id="tree-root">
                        <ol ui-tree-nodes="" ng-model="treedata">
                            <li ng-repeat="node in treedata" ui-tree-node ng-include="'nodes_renderer.html'"></li>
                        </ol>
                    </div>
                </div>
            </div>


            <div class='col-md-8' ng-if='isExpTab()' ng-controller='expDetailCtrl'>
                <div class="col-md-8" ng-if='!isActive()'>
            Choose from list.
                </div>
                <div ng-if='isActive()'>
                    <div ng-controller='titleController'>
                        <div editable-title></div>
                    </div>
                    <a class="btn btn-sm btn-default" ng-href='/exps/{{selectedItem.id}}'>See Detail</a>
                    <a class="btn btn-sm btn-danger" ng-click='deleteExp(this)'>Delete</a>
                    <div class="btn-group">
                        <label class="btn btn-default btn-sm" ng-model="showSection.note" btn-checkbox>Note</label>
                        <label class="btn btn-default btn-sm" ng-model="showSection.protocol" btn-checkbox>Protocol</label>
                        <label class="btn btn-default btn-sm" ng-model="showSection.sample" btn-checkbox>Samples</label>
                    </div>
                    {{showSection | json}}
                    @*<div ng-controller='protocolGraphCtrl'>*@
                    @*<svg>*@
                    @*<g ng-repeat='n in nodes'>*@
                    @*<rect style='fill: pink;' ng-attr-x='n.x' ng-attr-y='n.y' width='100' height='100'></rect>*@
                    @*</g>*@
                    @*</svg>*@
                    @*Hey*@
                    @*<span>{{exp.protocolSamples.length}} nodes.</span>*@
                    @*</div>*@
                    <section ng-show='showSection.note'>
                        <h4>Note</h4>
                        <textarea name="" id="explist_note" cols="30" rows="10" ng-model='selectedItem.note'></textarea>
                    </section>
                    <section ng-show='showSection.protocol'>
                        <h4>Protocol</h4>
                    </section>
                    <section ng-show='showSection.sample'>
                        <h4>Input</h4>
                        <div ng-controller='inputSamplesCtrl'>
                            <div exp-samples></div>
                        </div>

                        <h4>Output</h4>
                        <div ng-controller='outputSamplesCtrl'>
                            <div exp-samples></div>
                        </div>

                    </section>


                </div>


            </div>
            <div class='col-md-8' ng-if='isTypeTab()' ng-controller='typeDetailCtrl'>
                <div class="col-md-8" ng-if='!isActive()'>
            Choose from list.
                </div>
                <div class="col-md-8" ng-if='isActive()'>
                    <div ng-controller='titleController'>
                        <div editable-title></div>
                    </div>

                    <section>
                        <h3>Samples of this type</h3>
                         <span>{{(detail.samples|typeFilter:detail.id:showSubtypes).length}} samples.</span>
                        {{showAlsoSubtypes}}
                        <button class='btn btn-sm' ng-click='addSample()'>Add</button>
                        <input id='showsubtypes' type="checkbox" ng-model='showSubtypes'/>
                        <label for="showsubtypes">Show subtypes</label>
                        <table class='table col-md-3'>
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Type</th>
                                    <th>Date made</th>
                                    <th>Exp used</th>
                                    <th>Note</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat='sample in detail.samples | typeFilter:detail.id:showSubtypes'>

                                    <td><a href="/samples/{{sample.id}}">{{sample.name}}</a></td>
                                    <td>{{sample.typ.name}}</td>
                                    <td></td>
                                    <td></td>
                                    <td><a href="#" ng-click='deleteSample(sample)'>Delete</a></td>
                                </tr>
                            </tbody>
                        </table>


                    </section>

                </div>

            </div>
            <div class='col-md-8' ng-if='isSampleTab()' ng-controller='sampleDetailCtrl'>
                <div class="col-md-8" ng-if='!isActive()'>
            Choose from list.
                </div>
                <div class="col-md-8" ng-if='isActive()'>
                    <div ng-controller='titleController'>
                        <div editable-title></div>
                    </div>
                </div>
            </div>


        </div>
        <script type="text/javascript">
        </script>
        <script type="text/javascript" src="/public/javascripts/jquery-1.11.1.min.js" type="text/javascript"></script>
        <script type="text/javascript" src="/public/javascripts/underscore-min.js" type="text/javascript"></script>
        <script type="text/javascript" src="/public/javascripts/angular.min.js" type="text/javascript"></script>
        <script type="text/javascript" src="/public/javascripts/angular-route.js" type="text/javascript"></script>
        <script type="text/javascript" src="/public/javascripts/dagre-d3.js" type="text/javascript"></script>
        <script type="text/javascript" src='/public/javascripts/angular-ui-tree.js'></script>

        <script type="text/javascript" src="@routes.Assets.at("javascripts/my_directives.js")" type="text/javascript"></script>
        <script type="text/javascript" src="@routes.Assets.at("javascripts/libs/ui-bootstrap-0.11.0.min.js")" type="text/javascript"></script>
        <script type="text/javascript" src="@routes.Assets.at("javascripts/libs/ui-bootstrap-tpls-0.11.0.min.js")" type="text/javascript"></script>

        <script type="text/javascript" src="@routes.Assets.at("javascripts/experiment_list.js")" type="text/javascript"></script>

    </body>
</html>


